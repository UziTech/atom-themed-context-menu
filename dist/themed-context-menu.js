var d=Object.defineProperty;var p=n=>d(n,"__esModule",{value:!0});var C=(n,e)=>{for(var t in e)d(n,t,{get:e[t],enumerable:!0})};p(exports);C(exports,{activate:()=>x,deactivate:()=>g});var s=class{constructor(e,t,i){this.selected=!1;this.element=e,this.parent=t,this.height=i,this.element.addEventListener("click",o=>this.onMouseClick(o))}static createMenuItem(e,t){if(e.type==="separator")return new s(document.createElement("hr"),t,7);let i=document.createElement("div");i.classList.add("menu-item");let o=new s(i,t,23),m=document.createElement("span");m.classList.add("menu-item-name"),m.innerHTML=e.label?e.label:"";let a=document.createElement("span");if(a.classList.add("menu-item-key"),i.appendChild(m),i.appendChild(a),e.command!==void 0){o.command=e.command,o.commandDetail=e.commandDetail;let l=atom.keymaps.findKeyBindings({command:e.command});l.length>0&&(a.innerHTML=l[l.length-1].keystrokes)}return o}onMouseClick(e){e.stopPropagation(),this.execCommand(),this.parent.deleteContextMenu()}async execCommand(){var t;if(this.command===void 0)return;let e=((t=atom.workspace.getActiveTextEditor())==null?void 0:t.getElement())||atom.workspace.getActivePane().getElement();await atom.commands.dispatch(e,this.command,this.commandDetail)}getElement(){return this.element}getHeight(){return this.height}};var r=class{constructor(){this.visible=!1;this.children=[];let e=document.querySelector("atom-workspace");e==null||e.addEventListener("click",t=>this.onMouseClick(t)),this.activeContextMenu=document.createElement("div"),this.activeContextMenu.classList.add("themed-context-menu"),this.activeContextMenu.classList.add("invisible"),e==null||e.appendChild(this.activeContextMenu)}displayContextMenu(e,t){this.lastClick!==void 0&&this.lastClick!==e&&this.deleteContextMenu(),this.lastClick=e,this.activeContextMenu.classList.remove("invisible"),t.forEach(i=>{this.addChild(i)}),this.activeContextMenu.setAttribute("style",this.getPositionStyleString(e))}addChild(e){var i;let t=s.createMenuItem(e,this);this.children.push(t),(i=this.activeContextMenu)==null||i.appendChild(t.getElement())}onMouseClick(e){this.deleteContextMenu()}getPositionStyleString(e){let t=e.clientX+10+5,i=e.clientY+5;return t=Math.min(t,window.innerWidth-310),i=Math.min(i,window.innerHeight-this.getHeight()-10),"top:"+i+"px; left:"+t+"px"}getHeight(){return this.children.map(e=>e.getHeight()).reduce(function(e,t){return e+t})}deleteContextMenu(){this.visible=!1,this.children=[],this.activeContextMenu.classList.add(".invisible"),this.lastClick=void 0,this.removeAllChildNodes()}removeAllChildNodes(){for(;this.activeContextMenu.firstChild;)this.activeContextMenu.removeChild(this.activeContextMenu.firstChild)}};var c=class{constructor(e,t){this.items=[];this.elem=e,this.addItems(t)}hijackContextMenu(e){this.elem.addEventListener("contextmenu",t=>this.onContextMenu(t,e))}unhijackContextMenu(e){this.elem.removeEventListener("contextmenu",t=>this.onContextMenu(t,e))}onContextMenu(e,t){e.preventDefault(),e.stopPropagation(),t.displayContextMenu(e,this.items)}addItems(e){e.getItems().forEach(t=>this.addItem(t))}addItem(e){if(e.type){if(this.items.length===0)return;this.items[this.items.length-1].type||this.items.push(e)}else this.items.filter(i=>i.command===e.command).length===0&&this.items.push(e)}getElem(){return this.elem}getItems(){return this.items}};var u=new r,h=[];async function x(){console.log("hello!"),M(),v()}function g(){f()}function M(){let n=atom.contextMenu.itemSets,e=[];for(let t=0;t<n.length;t++){let i=n[t];document.querySelectorAll(i.selector).forEach(m=>e.push(new c(m,i.items)))}h=E(e)}function v(){h.forEach(n=>n.hijackContextMenu(u))}function f(){h.forEach(n=>n.unhijackContextMenu(u))}function E(n){for(let e=0;e<n.length;e++)for(let t=e+1;t<n.length;t++)n[e].getElem()===n[t].getElem()&&(n[e].addItems(n[t]),n.splice(t,1));return n}
//# sourceMappingURL=themed-context-menu.js.map
